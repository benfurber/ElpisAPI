commands:
  create_post_dir:
    command: "mkdir /opt/elasticbeanstalk/hooks/appdeploy/pre"
    ignoreErrors: true
files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/99_setup_prisma.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env bash
      set -e
      cd /var/app/current
      export PATH=$PATH:$(ls -td /opt/elasticbeanstalk/node-install/node-* | head -1)/bin
      export PRISMA_ENDPOINT=$(/opt/elasticbeanstalk/bin/get-config environment -k PRISMA_ENDPOINT)
      export PRISMA_SECRET=$(/opt/elasticbeanstalk/bin/get-config environment -k PRISMA_SECRET)
      npm install -g prisma
      npx prisma token
      echo $(/opt/elasticbeanstalk/bin/get-config container)
      echo $(/opt/elasticbeanstalk/bin/get-config environment)
      env